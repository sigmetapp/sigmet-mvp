# –ü—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è –ø–æ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –∑–∞–≥—Ä—É–∑–∫–∏ /feed

## –ê–Ω–∞–ª–∏–∑ —Ç–µ–∫—É—â–µ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

### –¢–µ–∫—É—â–∏–µ –ø—Ä–æ–±–ª–µ–º—ã

1. **–ë–æ–ª—å—à–æ–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç PostFeed** (1775+ —Å—Ç—Ä–æ–∫)
   - –í—Å–µ –ª–æ–≥–∏–∫–∞ –≤ –æ–¥–Ω–æ–º —Ñ–∞–π–ª–µ
   - –°–ª–æ–∂–Ω–æ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å –æ—Ç–¥–µ–ª—å–Ω—ã–µ —á–∞—Å—Ç–∏
   - –ë–æ–ª—å—à–æ–π bundle size

2. **–ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã –∫ Supabase**
   - –ó–∞–≥—Ä—É–∑–∫–∞ –ø–æ—Å—Ç–æ–≤
   - –ó–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–æ—Ñ–∏–ª–µ–π –∞–≤—Ç–æ—Ä–æ–≤ (–æ—Ç–¥–µ–ª—å–Ω—ã–π –∑–∞–ø—Ä–æ—Å)
   - –ó–∞–≥—Ä—É–∑–∫–∞ SW scores (–æ—Ç–¥–µ–ª—å–Ω—ã–π –∑–∞–ø—Ä–æ—Å)
   - –ó–∞–≥—Ä—É–∑–∫–∞ –ª–∞–π–∫–æ–≤ (–æ—Ç–¥–µ–ª—å–Ω—ã–π –∑–∞–ø—Ä–æ—Å)
   - –ó–∞–≥—Ä—É–∑–∫–∞ —Ä–µ–∞–∫—Ü–∏–π (–æ—Ç–¥–µ–ª—å–Ω—ã–π –∑–∞–ø—Ä–æ—Å)
   - –ó–∞–≥—Ä—É–∑–∫–∞ growth statuses (–æ—Ç–¥–µ–ª—å–Ω—ã–π –∑–∞–ø—Ä–æ—Å)
   - –ó–∞–≥—Ä—É–∑–∫–∞ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤ (–ø–æ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—é)
   - –ó–∞–≥—Ä—É–∑–∫–∞ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–π (directions)

3. **Lazy loading –æ—Ç–∫–ª—é—á–µ–Ω**
   - `enableLazyLoad={false}` –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ feed
   - –ó–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è 50 –ø–æ—Å—Ç–æ–≤ —Å—Ä–∞–∑—É
   - –ú–µ–¥–ª–µ–Ω–Ω–∞—è –ø–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞

4. **–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è**
   - –ö–∞–∂–¥—ã–π —Ä–∞–∑ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –≤—Å–µ –¥–∞–Ω–Ω—ã–µ –∑–∞–Ω–æ–≤–æ
   - –ù–µ—Ç –æ–ø—Ç–∏–º–∏—Å—Ç–∏—á–Ω—ã—Ö –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π
   - –ù–µ—Ç –∏–Ω–≤–∞–ª–∏–¥–∞—Ü–∏–∏ –∫–µ—à–∞

5. **–ù–µ–æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ä–µ–Ω–¥–µ—Ä—ã**
   - PostCard –Ω–µ –º–µ–º–æ–∏–∑–∏—Ä–æ–≤–∞–Ω
   - –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ —Ä–µ-—Ä–µ–Ω–¥–µ—Ä—ã –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è
   - –ù–µ—Ç –≤–∏—Ä—Ç—É–∞–ª–∏–∑–∞—Ü–∏–∏ —Å–ø–∏—Å–∫–∞

6. **–°–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ —Ç—è–∂–µ–ª—ã—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤**
   - EmojiPicker –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è —Å—Ä–∞–∑—É
   - PostComposer –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è —Å—Ä–∞–∑—É
   - –í—Å–µ –º–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞ –≤ bundle

---

## –ü—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è –ø–æ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏

### üî¥ –ö—Ä–∏—Ç–∏—á–Ω—ã–µ (–≤—ã—Å–æ–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç)

#### 1. –í–∫–ª—é—á–∏—Ç—å lazy loading —Å –ø–∞–≥–∏–Ω–∞—Ü–∏–µ–π

**–¢–µ–∫—É—â–∏–π –∫–æ–¥:**
```tsx
// app/(auth)/feed/page.tsx
<PostFeed
  enableLazyLoad={false}  // ‚ùå –û—Ç–∫–ª—é—á–µ–Ω–æ
  // ...
/>
```

**–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è:**
```tsx
// app/(auth)/feed/page.tsx
<PostFeed
  enableLazyLoad={true}  // ‚úÖ –í–∫–ª—é—á–µ–Ω–æ
  // ...
/>
```

**–í—ã–∏–≥—Ä—ã—à:**
- –ü–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞: 10 –ø–æ—Å—Ç–æ–≤ –≤–º–µ—Å—Ç–æ 50
- –£–º–µ–Ω—å—à–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏ –∑–∞–≥—Ä—É–∑–∫–∏ –Ω–∞ 60-80%
- –ú–µ–Ω—å—à–µ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏

---

#### 2. –û–±—ä–µ–¥–∏–Ω–∏—Ç—å –∑–∞–ø—Ä–æ—Å—ã –∫ Supabase (batch loading)

**–¢–µ–∫—É—â–∏–π –∫–æ–¥:**
```tsx
// components/PostFeed.tsx
const loadFeed = useCallback(async (...) => {
  // 1. –ó–∞–≥—Ä—É–∑–∫–∞ –ø–æ—Å—Ç–æ–≤
  const { data } = await supabase.from("posts").select("*")...
  
  // 2. –ó–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–æ—Ñ–∏–ª–µ–π (–æ—Ç–¥–µ–ª—å–Ω—ã–π –∑–∞–ø—Ä–æ—Å)
  const { data: profs } = await supabase
    .from("profiles")
    .select("user_id, username, full_name, avatar_url")
    .in("user_id", userIds);
  
  // 3. –ó–∞–≥—Ä—É–∑–∫–∞ SW scores (–æ—Ç–¥–µ–ª—å–Ω—ã–π –∑–∞–ø—Ä–æ—Å)
  const { data: swData } = await supabase
    .from("sw_scores")
    .select("user_id, total")
    .in("user_id", userIds);
}, []);
```

**–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è - –≤–∞—Ä–∏–∞–Ω—Ç 1 (RPC —Ñ—É–Ω–∫—Ü–∏—è):**
```sql
-- supabase/migrations/xxx_feed_data_rpc.sql
CREATE OR REPLACE FUNCTION get_feed_data(
  p_limit INTEGER DEFAULT 50,
  p_offset INTEGER DEFAULT 0,
  p_filter_type TEXT DEFAULT 'all',
  p_direction_id TEXT DEFAULT NULL,
  p_user_id_filter TEXT DEFAULT NULL
)
RETURNS JSON AS $$
DECLARE
  result JSON;
BEGIN
  SELECT json_build_object(
    'posts', (
      SELECT json_agg(json_build_object(
        'id', p.id,
        'user_id', p.user_id,
        'body', p.body,
        'image_url', p.image_url,
        'video_url', p.video_url,
        'category', p.category,
        'created_at', p.created_at,
        'views', p.views,
        'likes_count', p.likes_count
      ))
      FROM posts p
      WHERE (p_filter_type = 'all' OR ...)
      ORDER BY p.created_at DESC
      LIMIT p_limit OFFSET p_offset
    ),
    'profiles', (
      SELECT json_agg(json_build_object(
        'user_id', pr.user_id,
        'username', pr.username,
        'full_name', pr.full_name,
        'avatar_url', pr.avatar_url
      ))
      FROM profiles pr
      WHERE pr.user_id IN (
        SELECT DISTINCT user_id FROM posts ...
      )
    ),
    'sw_scores', (
      SELECT json_agg(json_build_object(
        'user_id', sw.user_id,
        'total', sw.total
      ))
      FROM sw_scores sw
      WHERE sw.user_id IN (...)
    )
  ) INTO result;
  
  RETURN result;
END;
$$ LANGUAGE plpgsql;
```

```tsx
// components/PostFeed.tsx
const loadFeed = useCallback(async (...) => {
  const { data, error } = await supabase.rpc('get_feed_data', {
    p_limit: limit,
    p_offset: offset,
    p_filter_type: filterType,
    p_direction_id: directionId,
    p_user_id_filter: filterUserId
  });
  
  if (data) {
    setPosts(data.posts);
    setProfilesByUserId(data.profiles);
    setSwScoresByUserId(data.sw_scores);
  }
}, []);
```

**–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è - –≤–∞—Ä–∏–∞–Ω—Ç 2 (–ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã):**
```tsx
// components/PostFeed.tsx
const loadFeed = useCallback(async (...) => {
  // –ó–∞–≥—Ä—É–∂–∞–µ–º –ø–æ—Å—Ç—ã
  const postsQuery = supabase.from("posts").select("*")...
  
  // –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ –∑–∞–≥—Ä—É–∂–∞–µ–º –ø—Ä–æ—Ñ–∏–ª–∏ –∏ SW scores
  const [postsResult, profilesResult, swScoresResult] = await Promise.all([
    postsQuery,
    userIds.length > 0 ? supabase
      .from("profiles")
      .select("user_id, username, full_name, avatar_url")
      .in("user_id", userIds) : Promise.resolve({ data: null }),
    userIds.length > 0 ? supabase
      .from("sw_scores")
      .select("user_id, total")
      .in("user_id", userIds) : Promise.resolve({ data: null })
  ]);
  
  // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
  if (postsResult.data) {
    setPosts(postsResult.data);
  }
  if (profilesResult.data) {
    setProfilesByUserId(/* ... */);
  }
  if (swScoresResult.data) {
    setSwScoresByUserId(/* ... */);
  }
}, []);
```

**–í—ã–∏–≥—Ä—ã—à:**
- –£–º–µ–Ω—å—à–µ–Ω–∏–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –∑–∞–ø—Ä–æ—Å–æ–≤ —Å 3+ –¥–æ 1 (RPC) –∏–ª–∏ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ
- –°–æ–∫—Ä–∞—â–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏ –∑–∞–≥—Ä—É–∑–∫–∏ –Ω–∞ 40-60%
- –ú–µ–Ω—å—à–µ –Ω–∞–≥—Ä—É–∑–∫–∞ –Ω–∞ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö

---

#### 3. –ú–µ–º–æ–∏–∑–∞—Ü–∏—è PostCard —Å React.memo

**–¢–µ–∫—É—â–∏–π –∫–æ–¥:**
```tsx
// components/PostCard.tsx
export default function PostCard({ post, ... }) {
  // –ù–µ—Ç –º–µ–º–æ–∏–∑–∞—Ü–∏–∏
}
```

**–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è:**
```tsx
// components/PostCard.tsx
import React from 'react';

const PostCard = React.memo(function PostCard({ post, ... }) {
  // ...
}, (prevProps, nextProps) => {
  // –ö–∞—Å—Ç–æ–º–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è —Å—Ä–∞–≤–Ω–µ–Ω–∏—è
  return (
    prevProps.post.id === nextProps.post.id &&
    prevProps.post.commentsCount === nextProps.post.commentsCount &&
    prevProps.post.content === nextProps.post.content &&
    prevProps.disableNavigation === nextProps.disableNavigation
  );
});

export default PostCard;
```

**–í—ã–∏–≥—Ä—ã—à:**
- –£–º–µ–Ω—å—à–µ–Ω–∏–µ —Ä–µ-—Ä–µ–Ω–¥–µ—Ä–æ–≤ –Ω–∞ 70-90%
- –£–ª—É—á—à–µ–Ω–∏–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ —Å–∫—Ä–æ–ª–ª–∏–Ω–≥–∞

---

#### 4. –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∑–∞–≥—Ä—É–∑–∫–∏ —Ä–µ–∞–∫—Ü–∏–π –∏ –ª–∞–π–∫–æ–≤

**–¢–µ–∫—É—â–∏–π –∫–æ–¥:**
```tsx
// –ó–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –æ—Ç–¥–µ–ª—å–Ω–æ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –ø–æ—Å—Ç–∞
useEffect(() => {
  if (posts.length === 0) return;
  const ids = posts.map((p) => p.id);
  const { data } = await supabase
    .from("post_reactions")
    .select("post_id, kind, user_id")
    .in("post_id", ids);
  // ...
}, [posts]);
```

**–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è:**
```tsx
// –ó–∞–≥—Ä—É–∂–∞–µ–º —Ä–µ–∞–∫—Ü–∏–∏ –≤–º–µ—Å—Ç–µ —Å –ø–æ—Å—Ç–∞–º–∏ —á–µ—Ä–µ–∑ JOIN –∏–ª–∏ RPC
// –ò–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ–º –æ–¥–∏–Ω –∑–∞–ø—Ä–æ—Å –¥–ª—è –≤—Å–µ—Ö –ø–æ—Å—Ç–æ–≤
const loadReactions = useCallback(async (postIds: number[]) => {
  if (postIds.length === 0) return;
  
  // Batch –∑–∞–ø—Ä–æ—Å –¥–ª—è –≤—Å–µ—Ö –ø–æ—Å—Ç–æ–≤ —Å—Ä–∞–∑—É
  const { data } = await supabase
    .from("post_reactions")
    .select("post_id, kind, user_id")
    .in("post_id", postIds);
  
  // –ì—Ä—É–ø–ø–∏—Ä—É–µ–º –ø–æ post_id
  const reactionsByPost = postIds.reduce((acc, id) => {
    acc[id] = { inspire: 0, respect: 0, relate: 0, support: 0, celebrate: 0 };
    return acc;
  }, {});
  
  if (data) {
    data.forEach(r => {
      const postId = r.post_id;
      const kind = r.kind;
      if (reactionsByPost[postId] && reactionsByPost[postId][kind] !== undefined) {
        reactionsByPost[postId][kind]++;
      }
    });
  }
  
  setReactionsByPostId(prev => ({ ...prev, ...reactionsByPost }));
}, []);
```

**–í—ã–∏–≥—Ä—ã—à:**
- –û–¥–∏–Ω –∑–∞–ø—Ä–æ—Å –≤–º–µ—Å—Ç–æ –º–Ω–æ–∂–µ—Å—Ç–≤–∞
- –£–º–µ–Ω—å—à–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏ –∑–∞–≥—Ä—É–∑–∫–∏ –Ω–∞ 30-50%

---

### üü° –í–∞–∂–Ω—ã–µ (—Å—Ä–µ–¥–Ω–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç)

#### 5. –í–∏—Ä—Ç—É–∞–ª–∏–∑–∞—Ü–∏—è —Å–ø–∏—Å–∫–∞ –ø–æ—Å—Ç–æ–≤

**–ü—Ä–æ–±–ª–µ–º–∞:** –ü—Ä–∏ –±–æ–ª—å—à–æ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–µ –ø–æ—Å—Ç–æ–≤ —Ä–µ–Ω–¥–µ—Ä—è—Ç—Å—è –≤—Å–µ —ç–ª–µ–º–µ–Ω—Ç—ã DOM

**–†–µ—à–µ–Ω–∏–µ:**
```tsx
// components/PostFeed.tsx
import { useVirtualizer } from '@tanstack/react-virtual';

export default function PostFeed({ ... }) {
  const parentRef = useRef<HTMLDivElement>(null);
  
  const virtualizer = useVirtualizer({
    count: posts.length,
    getScrollElement: () => parentRef.current,
    estimateSize: () => 300, // –ü—Ä–∏–º–µ—Ä–Ω–∞—è –≤—ã—Å–æ—Ç–∞ –ø–æ—Å—Ç–∞
    overscan: 5, // –†–µ–Ω–¥–µ—Ä–∏–º 5 –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤
  });
  
  return (
    <div ref={parentRef} className="h-screen overflow-auto">
      <div
        style={{
          height: `${virtualizer.getTotalSize()}px`,
          width: '100%',
          position: 'relative',
        }}
      >
        {virtualizer.getVirtualItems().map((virtualItem) => {
          const post = posts[virtualItem.index];
          return (
            <div
              key={virtualItem.key}
              style={{
                position: 'absolute',
                top: 0,
                left: 0,
                width: '100%',
                height: `${virtualItem.size}px`,
                transform: `translateY(${virtualItem.start}px)`,
              }}
            >
              <PostCard post={post} />
            </div>
          );
        })}
      </div>
    </div>
  );
}
```

**–í—ã–∏–≥—Ä—ã—à:**
- –†–µ–Ω–¥–µ—Ä–∏—Ç—Å—è —Ç–æ–ª—å–∫–æ –≤–∏–¥–∏–º—ã–µ –ø–æ—Å—Ç—ã + overscan
- –£–ª—É—á—à–µ–Ω–∏–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –ø—Ä–∏ –±–æ–ª—å—à–æ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–µ –ø–æ—Å—Ç–æ–≤
- –ü–ª–∞–≤–Ω—ã–π —Å–∫—Ä–æ–ª–ª–∏–Ω–≥

---

#### 6. –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π –∏–º–ø–æ—Ä—Ç —Ç—è–∂–µ–ª—ã—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤

**–¢–µ–∫—É—â–∏–π –∫–æ–¥:**
```tsx
// components/PostFeed.tsx
import EmojiPicker from "@/components/EmojiPicker";
import PostReportModal from "@/components/PostReportModal";
import ViewsChart from "@/components/ViewsChart";
// –í—Å–µ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è —Å—Ä–∞–∑—É
```

**–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è:**
```tsx
// components/PostFeed.tsx
import dynamic from 'next/dynamic';

const EmojiPicker = dynamic(() => import("@/components/EmojiPicker"), {
  ssr: false,
  loading: () => <div className="animate-pulse h-8 w-8 bg-gray-200 rounded" />
});

const PostReportModal = dynamic(() => import("@/components/PostReportModal"), {
  ssr: false,
});

const ViewsChart = dynamic(() => import("@/components/ViewsChart"), {
  ssr: false,
});
```

**–í—ã–∏–≥—Ä—ã—à:**
- –£–º–µ–Ω—å—à–µ–Ω–∏–µ initial bundle size –Ω–∞ 100-200KB
- –ë—ã—Å—Ç—Ä–µ–µ –ø–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞

---

#### 7. –ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö —Å React Query –∏–ª–∏ SWR

**–ü—Ä–æ–±–ª–µ–º–∞:** –ö–∞–∂–¥—ã–π —Ä–∞–∑ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –¥–∞–Ω–Ω—ã–µ –∑–∞–Ω–æ–≤–æ

**–†–µ—à–µ–Ω–∏–µ:**
```tsx
// lib/hooks/useFeed.ts
import { useQuery, useInfiniteQuery } from '@tanstack/react-query';
import { supabase } from '@/lib/supabaseClient';

export function useFeed(filterType, directionId, limit = 10) {
  return useInfiniteQuery({
    queryKey: ['feed', filterType, directionId],
    queryFn: async ({ pageParam = 0 }) => {
      const { data, error } = await supabase
        .from("posts")
        .select("*")
        .order("created_at", { ascending: false })
        .range(pageParam, pageParam + limit - 1);
      
      if (error) throw error;
      return data;
    },
    getNextPageParam: (lastPage, pages) => {
      if (lastPage.length < limit) return undefined;
      return pages.length * limit;
    },
    staleTime: 30000, // 30 —Å–µ–∫—É–Ω–¥
    cacheTime: 300000, // 5 –º–∏–Ω—É—Ç
  });
}

// components/PostFeed.tsx
import { useFeed } from '@/lib/hooks/useFeed';

export default function PostFeed({ ... }) {
  const { data, fetchNextPage, hasNextPage, isFetching } = useFeed(
    activeFilter,
    activeDirection,
    10
  );
  
  const posts = data?.pages.flat() ?? [];
  
  // ...
}
```

**–í—ã–∏–≥—Ä—ã—à:**
- –ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∏–Ω–≤–∞–ª–∏–¥–∞—Ü–∏—è
- –û–ø—Ç–∏–º–∏—Å—Ç–∏—á–Ω—ã–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
- Retry –ª–æ–≥–∏–∫–∞

---

#### 8. –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∑–∞–≥—Ä—É–∑–∫–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π

**–¢–µ–∫—É—â–∏–π –∫–æ–¥:**
```tsx
<img 
  src={p.image_url} 
  loading="lazy" 
  className="..."
/>
```

**–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è:**
```tsx
// –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å next/image –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏
import Image from 'next/image';

<Image
  src={p.image_url}
  alt="post image"
  width={800}
  height={600}
  loading="lazy"
  placeholder="blur"
  blurDataURL="data:image/jpeg;base64,..."
  className="..."
/>
```

**–í—ã–∏–≥—Ä—ã—à:**
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
- Lazy loading —Å placeholder
- –£–º–µ–Ω—å—à–µ–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π

---

### üü¢ –ñ–µ–ª–∞—Ç–µ–ª—å–Ω—ã–µ (–Ω–∏–∑–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç)

#### 9. –†–∞–∑–±–∏—Ç—å PostFeed –Ω–∞ –±–æ–ª–µ–µ –º–µ–ª–∫–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

**–¢–µ–∫—É—â–∏–π –∫–æ–¥:**
```tsx
// components/PostFeed.tsx (1775 —Å—Ç—Ä–æ–∫)
export default function PostFeed({ ... }) {
  // –í–µ—Å—å –∫–æ–¥ –≤ –æ–¥–Ω–æ–º –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–µ
}
```

**–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è:**
```tsx
// components/PostFeed/PostFeed.tsx
import PostComposer from './PostComposer';
import PostList from './PostList';
import PostFilters from './PostFilters';

export default function PostFeed({ ... }) {
  return (
    <div>
      <PostFilters />
      <PostComposer />
      <PostList />
    </div>
  );
}

// components/PostFeed/PostComposer.tsx
export default function PostComposer({ ... }) {
  // –õ–æ–≥–∏–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –ø–æ—Å—Ç–∞
}

// components/PostFeed/PostList.tsx
export default function PostList({ ... }) {
  // –õ–æ–≥–∏–∫–∞ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å–ø–∏—Å–∫–∞ –ø–æ—Å—Ç–æ–≤
}
```

**–í—ã–∏–≥—Ä—ã—à:**
- Code splitting
- –õ–µ–≥—á–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å
- –õ—É—á—à–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

---

#### 10. Prefetch –¥–∞–Ω–Ω—ã—Ö –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ

**–†–µ—à–µ–Ω–∏–µ:**
```tsx
// app/(auth)/feed/page.tsx
import { createServerClient } from '@/lib/supabaseServer';

export default async function FeedPage() {
  const supabase = createServerClient();
  
  // Prefetch –ø–æ—Å—Ç—ã –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
  const { data: initialPosts } = await supabase
    .from("posts")
    .select("*")
    .order("created_at", { ascending: false })
    .limit(10);
  
  return (
    <PostFeed initialPosts={initialPosts} />
  );
}
```

**–í—ã–∏–≥—Ä—ã—à:**
- –î–∞–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
- –ë—ã—Å—Ç—Ä–µ–µ –ø–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω—ã–π —Ä–µ–Ω–¥–µ—Ä
- –ú–µ–Ω—å—à–µ –∑–∞–ø—Ä–æ—Å–æ–≤ –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ

---

#### 11. –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è useEffect –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

**–¢–µ–∫—É—â–∏–π –∫–æ–¥:**
```tsx
useEffect(() => {
  // –ó–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –ø—Ä–∏ –∫–∞–∂–¥–æ–º –∏–∑–º–µ–Ω–µ–Ω–∏–∏ posts
  if (posts.length === 0) return;
  // ...
}, [posts]); // ‚ùå –ó–∞–≤–∏—Å–∏—Ç –æ—Ç –≤—Å–µ–≥–æ –º–∞—Å—Å–∏–≤–∞ posts
```

**–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è:**
```tsx
const postIds = useMemo(() => posts.map(p => p.id), [posts]);

useEffect(() => {
  if (postIds.length === 0) return;
  // ...
}, [postIds]); // ‚úÖ –ó–∞–≤–∏—Å–∏—Ç —Ç–æ–ª—å–∫–æ –æ—Ç ID –ø–æ—Å—Ç–æ–≤
```

**–í—ã–∏–≥—Ä—ã—à:**
- –ú–µ–Ω—å—à–µ –Ω–µ–Ω—É–∂–Ω—ã—Ö —Ä–µ-—Ä–µ–Ω–¥–µ—Ä–æ–≤
- –ë–æ–ª–µ–µ –ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ

---

#### 12. Debounce –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–æ–≤

**–ü—Ä–æ–±–ª–µ–º–∞:** –ü—Ä–∏ –±—ã—Å—Ç—Ä–æ–º –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–∏ —Ñ–∏–ª—å—Ç—Ä–æ–≤ –¥–µ–ª–∞–µ—Ç—Å—è –º–Ω–æ–≥–æ –∑–∞–ø—Ä–æ—Å–æ–≤

**–†–µ—à–µ–Ω–∏–µ:**
```tsx
import { useDebouncedCallback } from 'use-debounce';

const debouncedLoadFeed = useDebouncedCallback(
  (filterType, directionId) => {
    loadFeed(directionId, filterType, 0, limit);
  },
  300 // 300ms –∑–∞–¥–µ—Ä–∂–∫–∞
);

useEffect(() => {
  debouncedLoadFeed(activeFilter, activeDirection);
}, [activeFilter, activeDirection]);
```

**–í—ã–∏–≥—Ä—ã—à:**
- –ú–µ–Ω—å—à–µ –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ –ë–î
- –õ—É—á—à–∏–π UX

---

## –ü—Ä–∏–æ—Ä–∏—Ç–∏–∑–∞—Ü–∏—è –≤–Ω–µ–¥—Ä–µ–Ω–∏—è

### –§–∞–∑–∞ 1 (–ë—ã—Å—Ç—Ä—ã–µ –ø–æ–±–µ–¥—ã - 1-2 –¥–Ω—è)
1. ‚úÖ –í–∫–ª—é—á–∏—Ç—å lazy loading
2. ‚úÖ –ú–µ–º–æ–∏–∑–∞—Ü–∏—è PostCard
3. ‚úÖ –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã –∫ Supabase
4. ‚úÖ –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π –∏–º–ø–æ—Ä—Ç —Ç—è–∂–µ–ª—ã—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤

**–û–∂–∏–¥–∞–µ–º—ã–π –≤—ã–∏–≥—Ä—ã—à:** 40-60% —É–ª—É—á—à–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏ –∑–∞–≥—Ä—É–∑–∫–∏

### –§–∞–∑–∞ 2 (–°—Ä–µ–¥–Ω–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç - 3-5 –¥–Ω–µ–π)
5. ‚úÖ –û–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–æ–≤ —á–µ—Ä–µ–∑ RPC
6. ‚úÖ –ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Å React Query
7. ‚úÖ –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
8. ‚úÖ Debounce –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–æ–≤

**–û–∂–∏–¥–∞–µ–º—ã–π –≤—ã–∏–≥—Ä—ã—à:** –ï—â–µ 20-30% —É–ª—É—á—à–µ–Ω–∏–µ

### –§–∞–∑–∞ 3 (–î–æ–ª–≥–æ—Å—Ä–æ—á–Ω—ã–µ - 1-2 –Ω–µ–¥–µ–ª–∏)
9. ‚úÖ –í–∏—Ä—Ç—É–∞–ª–∏–∑–∞—Ü–∏—è —Å–ø–∏—Å–∫–∞
10. ‚úÖ –†–∞–∑–±–∏–µ–Ω–∏–µ –Ω–∞ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
11. ‚úÖ Prefetch –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
12. ‚úÖ –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è useEffect

**–û–∂–∏–¥–∞–µ–º—ã–π –≤—ã–∏–≥—Ä—ã—à:** –ü–ª–∞–≤–Ω—ã–π —Å–∫—Ä–æ–ª–ª–∏–Ω–≥, –ª—É—á—à–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

---

## –ú–µ—Ç—Ä–∏–∫–∏ –¥–ª—è –∏–∑–º–µ—Ä–µ–Ω–∏—è

1. **First Contentful Paint (FCP)**
   - –¶–µ–ª—å: < 1.5s
   - –¢–µ–∫—É—â–µ–µ: ~2-3s

2. **Largest Contentful Paint (LCP)**
   - –¶–µ–ª—å: < 2.5s
   - –¢–µ–∫—É—â–µ–µ: ~3-4s

3. **Time to Interactive (TTI)**
   - –¶–µ–ª—å: < 3.5s
   - –¢–µ–∫—É—â–µ–µ: ~5-6s

4. **Total Blocking Time (TBT)**
   - –¶–µ–ª—å: < 200ms
   - –¢–µ–∫—É—â–µ–µ: ~500-800ms

5. **Bundle Size**
   - –¶–µ–ª—å: < 200KB (initial)
   - –¢–µ–∫—É—â–µ–µ: ~300-400KB

---

## –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞

```bash
# Bundle analyzer
npm install --save-dev @next/bundle-analyzer

# React DevTools Profiler
# –í—Å—Ç—Ä–æ–µ–Ω –≤ Chrome DevTools

# Web Vitals
npm install web-vitals
```

---

## –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

–†–µ–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–Ω—ã—Ö –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–π –ø–æ–∑–≤–æ–ª–∏—Ç:
- ‚ö° –£—Å–∫–æ—Ä–∏—Ç—å –∑–∞–≥—Ä—É–∑–∫—É feed –Ω–∞ 60-80%
- üì¶ –£–º–µ–Ω—å—à–∏—Ç—å bundle size –Ω–∞ 20-30%
- üéØ –£–ª—É—á—à–∏—Ç—å UX –∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
- üîß –£–ø—Ä–æ—Å—Ç–∏—Ç—å –ø–æ–¥–¥–µ—Ä–∂–∫—É –∫–æ–¥–∞

–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –Ω–∞—á–∞—Ç—å —Å –§–∞–∑—ã 1 –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ —ç—Ñ—Ñ–µ–∫—Ç–∞, –∑–∞—Ç–µ–º –ø–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ –≤–Ω–µ–¥—Ä—è—Ç—å –æ—Å—Ç–∞–ª—å–Ω—ã–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏.
