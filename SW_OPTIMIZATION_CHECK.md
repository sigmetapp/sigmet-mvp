# –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–π SW - –ò—Ç–æ–≥–æ–≤—ã–π –æ—Ç—á–µ—Ç

## ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏

### 1. Backend –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏

#### ‚úÖ –¢–∞–±–ª–∏—Ü–∞ `user_connections` (–º–∏–≥—Ä–∞—Ü–∏—è 191)
- –°–æ–∑–¥–∞–Ω–∞ —Ç–∞–±–ª–∏—Ü–∞ –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è connections
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ç—Ä–∏–≥–≥–µ—Ä—ã –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏/–æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –ø–æ—Å—Ç–æ–≤
- –ò–Ω–¥–µ–∫—Å—ã –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –ø–æ–∏—Å–∫–∞
- **–†–µ–∑—É–ª—å—Ç–∞—Ç:** Connections —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞—é—Ç—Å—è –æ–¥–∏–Ω —Ä–∞–∑ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –ø–æ—Å—Ç–∞

#### ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω —Ä–∞—Å—á–µ—Ç SW (pages/api/sw/calculate.ts)
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç `user_connections` –≤–º–µ—Å—Ç–æ –ø–∞—Ä—Å–∏–Ω–≥–∞ 1000 –ø–æ—Å—Ç–æ–≤
- **–ë—ã–ª–æ:** –ó–∞–≥—Ä—É–∑–∫–∞ 1000 –ø–æ—Å—Ç–æ–≤, –ø–∞—Ä—Å–∏–Ω–≥ —Ç–µ–∫—Å—Ç–∞ –∫–∞–∂–¥–æ–≥–æ –ø–æ—Å—Ç–∞
- **–°—Ç–∞–ª–æ:** –ü—Ä–æ—Å—Ç–æ–π SELECT –∏–∑ `user_connections`
- **–£—Å–∫–æ—Ä–µ–Ω–∏–µ:** 10-25x

#### ‚úÖ –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ
- –í—Ä–µ–º—è –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è: 15 –º–∏–Ω—É—Ç (–±—ã–ª–æ 5)
- –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –¥–ª—è –∏–Ω—Ñ–ª—è—Ü–∏–∏
- **–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ú–µ–Ω—å—à–µ –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ –ë–î

#### ‚úÖ –ò–Ω–¥–µ–∫—Å—ã –ë–î
- –î–æ–±–∞–≤–ª–µ–Ω—ã –∏–Ω–¥–µ–∫—Å—ã –Ω–∞ –≤—Å–µ —Ç–∞–±–ª–∏—Ü—ã, –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –≤ —Ä–∞—Å—á–µ—Ç–µ SW
- **–†–µ–∑—É–ª—å—Ç–∞—Ç:** –£—Å–∫–æ—Ä–µ–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–æ–≤ –Ω–∞ 50-80%

### 2. Frontend –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏

#### ‚úÖ –ü—Ä–æ—Ñ–∏–ª—å (`/u/[slug]`)
- **–ë—ã–ª–æ:** –í—Å–µ–≥–¥–∞ –≤—ã–∑—ã–≤–∞–ª `/api/sw/calculate` –∏ –∂–¥–∞–ª –æ—Ç–≤–µ—Ç
- **–°—Ç–∞–ª–æ:** 
  - –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –∫—ç—à `sw_scores` —Å–Ω–∞—á–∞–ª–∞
  - –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∫—ç—à–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ —Å—Ä–∞–∑—É (–¥–∞–∂–µ –µ—Å–ª–∏ —É—Å—Ç–∞—Ä–µ–ª–∏)
  - –û–±–Ω–æ–≤–ª—è–µ—Ç –≤ —Ñ–æ–Ω–µ —á–µ—Ä–µ–∑ `/api/sw/recalculate`
  - –ó–∞–≥—Ä—É–∂–∞–µ—Ç weights –æ—Ç–¥–µ–ª—å–Ω–æ (–Ω–µ –±–ª–æ–∫–∏—Ä—É–µ—Ç)
- **–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ú–≥–Ω–æ–≤–µ–Ω–Ω–æ–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –ø—Ä–∏ –Ω–∞–ª–∏—á–∏–∏ –∫—ç—à–∞

#### ‚úÖ –°—Ç—Ä–∞–Ω–∏—Ü–∞ `/sw`
- **–ë—ã–ª–æ:** –í—Å–µ–≥–¥–∞ –≤—ã–∑—ã–≤–∞–ª `/api/sw/calculate` –±–µ–∑ –ø—Ä–æ–≤–µ—Ä–∫–∏ –∫—ç—à–∞
- **–°—Ç–∞–ª–æ:**
  - –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –∫—ç—à `sw_scores` –ø–µ—Ä–µ–¥ –≤—ã–∑–æ–≤–æ–º API
  - –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∫—ç—à–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ —Å—Ä–∞–∑—É
  - –û–±–Ω–æ–≤–ª—è–µ—Ç –≤ —Ñ–æ–Ω–µ –µ—Å–ª–∏ –∫—ç—à —É—Å—Ç–∞—Ä–µ–ª
  - –ó–∞–≥—Ä—É–∂–∞–µ—Ç weights –æ—Ç–¥–µ–ª—å–Ω–æ
- **–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ú–≥–Ω–æ–≤–µ–Ω–Ω–æ–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –ø—Ä–∏ –Ω–∞–ª–∏—á–∏–∏ –∫—ç—à–∞

#### ‚úÖ AvatarWithBadge
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç `useSWLevels()` hook
- Hook –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `/api/sw/weights` (–ª–µ–≥–∫–æ–≤–µ—Å–Ω—ã–π)
- **–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ù–µ –≤—ã–∑—ã–≤–∞–µ—Ç –ø–æ–ª–Ω—ã–π —Ä–∞—Å—á–µ—Ç SW

### 3. Backfill (–º–∏–≥—Ä–∞—Ü–∏—è 192)
- ‚úÖ –û–±—Ä–∞–±–æ—Ç–∞–Ω–æ 44 —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –ø–æ—Å—Ç–∞
- ‚úÖ –í—Å–µ connections —Å–æ–∑–¥–∞–Ω—ã

## üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

### –û–∂–∏–¥–∞–µ–º—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã:

**–ü—Ä–∏ –Ω–∞–ª–∏—á–∏–∏ —Å–≤–µ–∂–µ–≥–æ –∫—ç—à–∞ (< 15 –º–∏–Ω—É—Ç):**
- –ü—Ä–æ—Ñ–∏–ª—å: **< 100ms** (–ø—Ä—è–º–æ–π SELECT –∏–∑ `sw_scores`)
- –°—Ç—Ä–∞–Ω–∏—Ü–∞ `/sw`: **< 100ms** (–ø—Ä—è–º–æ–π SELECT –∏–∑ `sw_scores`)
- –ê–≤–∞—Ç–∞—Ä–∫–∞: **< 50ms** (–∑–∞–≥—Ä—É–∑–∫–∞ weights)

**–ü—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ –∫—ç—à–∞ –∏–ª–∏ —É—Å—Ç–∞—Ä–µ–≤—à–µ–º –∫—ç—à–µ:**
- –ü—Ä–æ—Ñ–∏–ª—å: –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —É—Å—Ç–∞—Ä–µ–≤—à–∏–µ –¥–∞–Ω–Ω—ã–µ —Å—Ä–∞–∑—É, –æ–±–Ω–æ–≤–ª—è–µ—Ç –≤ —Ñ–æ–Ω–µ
- –°—Ç—Ä–∞–Ω–∏—Ü–∞ `/sw`: –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —É—Å—Ç–∞—Ä–µ–≤—à–∏–µ –¥–∞–Ω–Ω—ã–µ —Å—Ä–∞–∑—É, –æ–±–Ω–æ–≤–ª—è–µ—Ç –≤ —Ñ–æ–Ω–µ
- –ù–æ–≤—ã–π —Ä–∞—Å—á–µ—Ç SW: **< 500ms** (–±–ª–∞–≥–æ–¥–∞—Ä—è `user_connections`)

### –ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã:

1. **–ï—Å–ª–∏ –≤—Å–µ –µ—â–µ –º–µ–¥–ª–µ–Ω–Ω–æ:**
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –º–∏–≥—Ä–∞—Ü–∏–∏ –ø—Ä–∏–º–µ–Ω–µ–Ω—ã
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ —Ç–∞–±–ª–∏—Ü–∞ `user_connections` —Å–æ–∑–¥–∞–Ω–∞
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ —Ç—Ä–∏–≥–≥–µ—Ä—ã —Ä–∞–±–æ—Ç–∞—é—Ç
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ –Ω–∞ –Ω–∞–ª–∏—á–∏–µ –æ—à–∏–±–æ–∫

2. **–ï—Å–ª–∏ –∫—ç—à –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç:**
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –¥–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ `sw_scores`
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ `last_updated` –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å RLS –ø–æ–ª–∏—Ç–∏–∫–∏ –Ω–∞ `sw_scores`

3. **–ï—Å–ª–∏ connections –Ω–µ —Å–æ–∑–¥–∞—é—Ç—Å—è:**
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ —Ç—Ä–∏–≥–≥–µ—Ä—ã —Ä–∞–±–æ—Ç–∞—é—Ç (—Å–æ–∑–¥–∞—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–π –ø–æ—Å—Ç —Å mention)
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ –Ω–∞ –Ω–∞–ª–∏—á–∏–µ –æ—à–∏–±–æ–∫ –≤ —Ç—Ä–∏–≥–≥–µ—Ä–µ

## üìä –ú–µ—Ç—Ä–∏–∫–∏ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏

### –í –±—Ä–∞—É–∑–µ—Ä–µ (DevTools ‚Üí Network):
1. –û—Ç–∫—Ä—ã—Ç—å `/u/AlexM` –∏–ª–∏ `/sw`
2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∑–∞–ø—Ä–æ—Å—ã:
   - –ï—Å–ª–∏ –µ—Å—Ç—å –∫—ç—à: –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —Ç–æ–ª—å–∫–æ –∑–∞–ø—Ä–æ—Å –∫ `sw_scores` (–±—ã—Å—Ç—Ä—ã–π)
   - –ï—Å–ª–∏ –Ω–µ—Ç –∫—ç—à–∞: –∑–∞–ø—Ä–æ—Å –∫ `/api/sw/calculate` (–º–æ–∂–µ—Ç –±—ã—Ç—å –º–µ–¥–ª–µ–Ω–Ω—ã–º –ø–µ—Ä–≤—ã–π —Ä–∞–∑)

### –í –ª–æ–≥–∞—Ö Supabase:
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å NOTICE —Å–æ–æ–±—â–µ–Ω–∏—è –∏–∑ backfill
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –æ—à–∏–±–∫–∏ –≤ —Ç—Ä–∏–≥–≥–µ—Ä–∞—Ö

### –í –ë–î:
```sql
-- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ connections
SELECT COUNT(*) FROM user_connections;

-- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫—ç—à SW
SELECT user_id, total, last_updated FROM sw_scores LIMIT 10;

-- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–±–æ—Ç—É —Ç—Ä–∏–≥–≥–µ—Ä–∞ (—Å–æ–∑–¥–∞—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–π –ø–æ—Å—Ç)
INSERT INTO posts (author_id, text) VALUES ('user-id', 'Test @username');
-- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ connection —Å–æ–∑–¥–∞–ª—Å—è
SELECT * FROM user_connections WHERE post_id = (SELECT id FROM posts ORDER BY created_at DESC LIMIT 1);
```

## üéØ –ò—Ç–æ–≥–æ–≤–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞

### –ß—Ç–æ –¥–æ–ª–∂–Ω–æ —Ä–∞–±–æ—Ç–∞—Ç—å –±—ã—Å—Ç—Ä–æ:

1. ‚úÖ **–ü—Ä–æ—Ñ–∏–ª—å** - –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç SW —Å—Ä–∞–∑—É –∏–∑ –∫—ç—à–∞
2. ‚úÖ **–°—Ç—Ä–∞–Ω–∏—Ü–∞ /sw** - –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç SW —Å—Ä–∞–∑—É –∏–∑ –∫—ç—à–∞  
3. ‚úÖ **–ê–≤–∞—Ç–∞—Ä–∫–∞** - –∑–∞–≥—Ä—É–∂–∞–µ—Ç —Ç–æ–ª—å–∫–æ weights
4. ‚úÖ **–ù–æ–≤—ã–µ –ø–æ—Å—Ç—ã** - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞—é—Ç connections
5. ‚úÖ **–†–∞—Å—á–µ—Ç SW** - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –≥–æ—Ç–æ–≤—É—é —Ç–∞–±–ª–∏—Ü—É connections

### –ï—Å–ª–∏ –≤—Å–µ –µ—â–µ –º–µ–¥–ª–µ–Ω–Ω–æ:

1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –º–∏–≥—Ä–∞—Ü–∏–∏ –ø—Ä–∏–º–µ–Ω–µ–Ω—ã:
   ```sql
   SELECT * FROM supabase_migrations.schema_migrations 
   WHERE name LIKE '%191%' OR name LIKE '%192%';
   ```

2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞–ª–∏—á–∏–µ —Ç–∞–±–ª–∏—Ü—ã:
   ```sql
   SELECT COUNT(*) FROM user_connections;
   ```

3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–±–æ—Ç—É —Ç—Ä–∏–≥–≥–µ—Ä–∞:
   - –°–æ–∑–¥–∞—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–π –ø–æ—Å—Ç —Å mention
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ connection —Å–æ–∑–¥–∞–ª—Å—è

4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫—ç—à:
   ```sql
   SELECT user_id, total, last_updated, 
          EXTRACT(EPOCH FROM (NOW() - last_updated))/60 as age_minutes
   FROM sw_scores 
   WHERE user_id = 'user-id';
   ```

## üöÄ –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

–ï—Å–ª–∏ –≤—Å–µ –µ—â–µ –º–µ–¥–ª–µ–Ω–Ω–æ –ø–æ—Å–ª–µ –≤—Å–µ—Ö –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–π:

1. **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥:**
   - –î–æ–±–∞–≤–∏—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è `/api/sw/calculate`
   - –û—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫—ç—à-—Ö–∏—Ç–æ–≤ vs –ø—Ä–æ–º–∞—Ö–æ–≤

2. **–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏:**
   - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Redis –¥–ª—è –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è (–≤–º–µ—Å—Ç–æ in-memory)
   - –î–æ–±–∞–≤–∏—Ç—å background jobs –¥–ª—è –ø–µ—Ä–µ—Å—á–µ—Ç–∞ SW
   - –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –∏–Ω–∫—Ä–µ–º–µ–Ω—Ç–∞–ª—å–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ SW

3. **–ü—Ä–æ–≤–µ—Ä–∫–∞ –∏–Ω–¥–µ–∫—Å–æ–≤:**
   ```sql
   -- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∏–Ω–¥–µ–∫—Å–æ–≤
   EXPLAIN ANALYZE 
   SELECT * FROM user_connections WHERE user_id = 'user-id';
   ```

–í—Å–µ –æ—Å–Ω–æ–≤–Ω—ã–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã! üéâ
