"use strict";(()=>{var e={};e.id=678,e.ids=[678],e.modules={2885:e=>{e.exports=require("@supabase/supabase-js")},145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},6249:(e,r)=>{Object.defineProperty(r,"l",{enumerable:!0,get:function(){return function e(r,t){return t in r?r[t]:"then"in r&&"function"==typeof r.then?r.then(r=>e(r,t)):"function"==typeof r&&"default"===t?r:void 0}}})},4506:(e,r,t)=>{t.r(r),t.d(r,{config:()=>l,default:()=>d,routeModule:()=>c});var s={};t.r(s),t.d(s,{default:()=>u});var a=t(1802),n=t(7153),o=t(6249),i=t(6042);async function u(e,r){if("POST"!==e.method)return r.status(405).json({ok:!1,error:"Method not allowed"});try{let{client:t,user:s}=await (0,i.N)(e),a=e.body?.participant_ids||[],n=e.body?.title||null,o=Array.from(new Set(a.filter(Boolean))).filter(e=>e!==s.id);if(0===o.length)return r.status(400).json({ok:!1,error:"participant_ids required"});if(1===o.length){let e=s.id,a=o[0],{data:n,error:i}=await t.rpc("ensure_1on1_thread",{a:e,b:a}).maybeSingle();if(i)return r.status(400).json({ok:!1,error:i.message});return r.status(200).json({ok:!0,thread:n})}let{data:u,error:d}=await t.from("dms_threads").insert({created_by:s.id,is_group:!0,title:n}).select("*").single();if(d||!u)return r.status(400).json({ok:!1,error:d?.message||"Failed to create thread"});let l=Array.from(new Set([s.id,...o])).map(e=>({thread_id:u.id,user_id:e,role:e===s.id?"owner":"member"})),{error:c}=await t.from("dms_thread_participants").insert(l);if(c)return r.status(400).json({ok:!1,error:c.message});return r.status(200).json({ok:!0,thread:u})}catch(t){let e=t?.status||500;return r.status(e).json({ok:!1,error:t?.message||"Internal error"})}}let d=(0,o.l)(s,"default"),l=(0,o.l)(s,"config"),c=new a.PagesAPIRouteModule({definition:{kind:n.x.PAGES_API,page:"/api/dms/threads.create",pathname:"/api/dms/threads.create",bundlePath:"",filename:""},userland:s})},6042:(e,r,t)=>{t.d(r,{N:()=>a});var s=t(2885);async function a(e){let r=function(e){let r=process.env.NEXT_PUBLIC_SUPABASE_URL,t=process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY,a=function(e){let r=e.headers.authorization||e.headers.Authorization;return"string"==typeof r&&r.toLowerCase().startsWith("bearer ")?r.slice(7):e.cookies?.["sb-access-token"]||e.cookies?.["access-token"]}(e),n={};return a&&(n.Authorization=`Bearer ${a}`),(0,s.createClient)(r,t,{auth:{persistSession:!1,autoRefreshToken:!1,detectSessionInUrl:!1},global:{headers:n}})}(e),{data:t,error:a}=await r.auth.getUser();if(a||!t?.user)throw Object.assign(Error("Unauthorized"),{status:401});return{client:r,user:t.user}}},7153:(e,r)=>{var t;Object.defineProperty(r,"x",{enumerable:!0,get:function(){return t}}),function(e){e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE"}(t||(t={}))},1802:(e,r,t)=>{e.exports=t(145)}};var r=require("../../../webpack-api-runtime.js");r.C(e);var t=r(r.s=4506);module.exports=t})();