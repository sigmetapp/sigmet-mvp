"use strict";(()=>{var e={};e.id=986,e.ids=[986,660],e.modules={8017:(e,t,i)=>{i.a(e,async(e,s)=>{try{i.r(t),i.d(t,{config:()=>j,default:()=>h,getServerSideProps:()=>p,getStaticPaths:()=>x,getStaticProps:()=>m,reportWebVitals:()=>g,routeModule:()=>y,unstable_getServerProps:()=>f,unstable_getServerSideProps:()=>N,unstable_getStaticParams:()=>v,unstable_getStaticPaths:()=>b,unstable_getStaticProps:()=>w});var a=i(7093),r=i(5244),l=i(1323),n=i(2899),d=i.n(n),o=i(5072),c=i(3663),u=e([c]);c=(u.then?(await u)():u)[0];let h=(0,l.l)(c,"default"),m=(0,l.l)(c,"getStaticProps"),x=(0,l.l)(c,"getStaticPaths"),p=(0,l.l)(c,"getServerSideProps"),j=(0,l.l)(c,"config"),g=(0,l.l)(c,"reportWebVitals"),w=(0,l.l)(c,"unstable_getStaticProps"),b=(0,l.l)(c,"unstable_getStaticPaths"),v=(0,l.l)(c,"unstable_getStaticParams"),f=(0,l.l)(c,"unstable_getServerProps"),N=(0,l.l)(c,"unstable_getServerSideProps"),y=new a.PagesRouteModule({definition:{kind:r.x.PAGES,page:"/feed",pathname:"/feed",bundlePath:"",filename:""},components:{App:o.default,Document:d()},userland:c});s()}catch(e){s(e)}})},1695:(e,t,i)=>{i.d(t,{Y:()=>l});var s=i(997),a=i(6689);i(3067);var r=i(1163);function l({children:e}){(0,r.useRouter)();let[t,i]=(0,a.useState)(!1);return t?s.jsx(s.Fragment,{children:e}):null}},3663:(e,t,i)=>{i.a(e,async(e,s)=>{try{i.r(t),i.d(t,{default:()=>c});var a=i(997),r=i(6689),l=i(3067),n=i(1695),d=i(6044),o=e([d]);function c(){return a.jsx(n.Y,{children:a.jsx(u,{})})}function u(){let[e,t]=(0,r.useState)(""),[i,s]=(0,r.useState)(null),[n,o]=(0,r.useState)(null),c=(0,r.useRef)(null),[u,h]=(0,r.useState)(null),[m,x]=(0,r.useState)([]),[p,j]=(0,r.useState)(!0),[g,w]=(0,r.useState)(!1),[b,v]=(0,r.useState)(!1),[f,N]=(0,r.useState)({}),[y,S]=(0,r.useState)(null),[k,D]=(0,r.useState)(""),[_,C]=(0,r.useState)({}),[P,q]=(0,r.useState)({}),[M,E]=(0,r.useState)({}),[W,$]=(0,r.useState)({}),[F,O]=(0,r.useState)(new Set),Z=(0,r.useRef)(new Set),V=(0,r.useMemo)(()=>[{id:"health",emoji:"\uD83D\uDC9A",title:"Health"},{id:"thinking",emoji:"\uD83E\uDDE0",title:"Thinking"},{id:"learning",emoji:"\uD83D\uDCDA",title:"Learning"},{id:"career",emoji:"\uD83E\uDDE9",title:"Career"},{id:"finance",emoji:"\uD83D\uDCB0",title:"Finance"},{id:"relationships",emoji:"\uD83E\uDD1D",title:"Relationships"},{id:"creativity",emoji:"\uD83C\uDFA8",title:"Creativity"},{id:"sport",emoji:"\uD83C\uDFC3‍♂️",title:"Sport"},{id:"habits",emoji:"⏱️",title:"Habits"},{id:"emotions",emoji:"\uD83C\uDF3F",title:"Emotions"},{id:"meaning",emoji:"✨",title:"Meaning"},{id:"community",emoji:"\uD83C\uDFD9️",title:"Community"}],[]),[A,L]=(0,r.useState)([]),[B,R]=(0,r.useState)(null);async function Y(e,t){let i=e.name.split(".").pop()||"bin",s=`${t}/${Date.now()}-${Math.random().toString(36).slice(2)}.${i}`,a=l.O.storage.from("posts"),{error:r}=await a.upload(s,e,{upsert:!1,contentType:e.type});if(r)throw r;let{data:n}=a.getPublicUrl(s);return n.publicUrl}async function z(){if(!u)return alert("Sign in required");if(!e&&!i&&!n)return alert("Post cannot be empty");w(!0);try{let a=null,r=null;i&&(a=await Y(i,"images")),n&&(r=await Y(n,"videos"));let{data:d,error:c}=await l.O.from("posts").insert({user_id:u,body:e||null,image_url:a,video_url:r}).select("*").single();if(c)throw c;d&&(x(e=>[d,...e]),$(e=>({...e,[d.id]:0}))),t(""),s(null),o(null),v(!1)}catch(e){alert(e.message||"Publish error")}finally{w(!1)}}async function G(e){if(!Z.current.has(e)){Z.current.add(e),x(t=>t.map(t=>t.id===e?{...t,views:(t.views??0)+1}:t));try{let{error:t}=await l.O.rpc("increment_post_views",{p_id:e});if(t)throw t}catch{let t=m.find(t=>t.id===e)?.views??0;await l.O.from("posts").update({views:t+1}).eq("id",e)}}}async function U(e){if(!u)return alert("Sign in required");if(F.has(e.id)){let{error:t}=await l.O.from("post_likes").delete().eq("post_id",e.id).eq("user_id",u);t||(O(t=>{let i=new Set(t);return i.delete(e.id),i}),x(t=>t.map(t=>t.id===e.id?{...t,likes_count:Math.max(0,(t.likes_count??1)-1)}:t)))}else{let{error:t}=await l.O.from("post_likes").insert({post_id:e.id,user_id:u});t||(O(t=>new Set(t).add(e.id)),x(t=>t.map(t=>t.id===e.id?{...t,likes_count:(t.likes_count??0)+1}:t)))}}async function H(e){if(!confirm("Delete this post?"))return;let{error:t}=await l.O.from("posts").delete().eq("id",e.id);if(t)return alert(t.message);x(t=>t.filter(t=>t.id!==e.id))}async function T(e){let{data:t,error:i}=await l.O.from("posts").update({body:k}).eq("id",e.id).select("*").single();!i&&t&&(x(i=>i.map(i=>i.id===e.id?t:i)),S(null))}async function I(e){let{data:t,error:i,count:s}=await l.O.from("comments").select("*",{count:"exact"}).eq("post_id",e).order("created_at",{ascending:!0});!i&&t&&(E(i=>({...i,[e]:t})),$(i=>({...i,[e]:s??t.length})))}async function X(e){if(!u)return alert("Sign in required");let t=(P[e]||"").trim();if(!t)return;let{data:i,error:s}=await l.O.from("comments").insert({post_id:e,user_id:u,body:t}).select("*").single();!s&&i&&(E(t=>({...t,[e]:[...t[e]||[],i]})),$(t=>({...t,[e]:(t[e]??0)+1})),q(t=>({...t,[e]:""})))}let J=()=>(0,a.jsxs)("svg",{viewBox:"0 0 24 24",className:"h-5 w-5",children:[a.jsx("path",{d:"M2 12s3.5-7 10-7 10 7 10 7-3.5 7-10 7S2 12 2 12Z",stroke:"currentColor",strokeWidth:"1.5"}),a.jsx("circle",{cx:"12",cy:"12",r:"3",stroke:"currentColor",strokeWidth:"1.5"})]}),K=()=>(0,a.jsxs)("svg",{viewBox:"0 0 24 24",className:"h-5 w-5",fill:"none",stroke:"currentColor",strokeWidth:"1.5",children:[a.jsx("path",{d:"M16.862 3.487a1.75 1.75 0 0 1 2.476 2.476l-10.3 10.3a4 4 0 0 1-1.694 1.01l-3.2.914.914-3.2a4 4 0 0 1 1.01-1.694l10.294-10.306Z"}),a.jsx("path",{d:"M15 5l4 4"})]}),Q=()=>(0,a.jsxs)("svg",{viewBox:"0 0 24 24",className:"h-5 w-5",fill:"none",stroke:"currentColor",strokeWidth:"1.5",children:[a.jsx("path",{d:"M4 7h16"}),a.jsx("path",{d:"M10 11v6"}),a.jsx("path",{d:"M14 11v6"}),a.jsx("path",{d:"M6 7l1 12a2 2 0 0 0 2 2h6a2 2 0 0 0 2-2l1-12"}),a.jsx("path",{d:"M9 7V5a2 2 0 0 1 2-2h2a2 2 0 0 1 2 2v2"})]}),ee=()=>(0,a.jsxs)("svg",{viewBox:"0 0 24 24",className:"h-5 w-5",fill:"none",stroke:"currentColor",strokeWidth:"1.5",children:[a.jsx("path",{d:"M12 5v14"}),a.jsx("path",{d:"M5 12h14"})]});return(0,a.jsxs)("div",{className:"max-w-7xl mx-auto px-4 py-6 md:py-8",children:[a.jsx("div",{className:"mb-6 md:mb-8",children:(0,a.jsxs)("div",{className:"flex items-end justify-between",children:[(0,a.jsxs)("div",{children:[a.jsx("h1",{className:"text-2xl md:text-3xl font-semibold tracking-tight gradient-text",children:"Your feed"}),a.jsx("p",{className:"text-white/70 mt-1",children:"Share progress and see what others are building."})]}),a.jsx("div",{className:"hidden sm:block",children:a.jsx(d.Z,{onClick:()=>v(!0),variant:"primary",className:"shadow-md",icon:a.jsx(ee,{}),children:"Create post"})})]})}),(0,a.jsxs)("div",{className:"max-w-3xl mx-auto space-y-6",children:[A.length>0&&a.jsx("div",{className:"card p-3 md:p-4",children:a.jsx("div",{className:"flex flex-wrap items-center gap-2",children:A.map(e=>{let t=V.find(t=>t.id===e),i=t?`${t.emoji} ${t.title}`:e,s=B===e;return a.jsx("button",{onClick:()=>R(e),className:`px-3 py-1.5 rounded-full text-sm transition border ${s?"bg-white text-black border-white":"text-white/80 border-white/20 hover:bg-white/10"}`,children:i},e)})})}),p?a.jsx("div",{className:"text-white/60",children:"Loading…"}):m.map(e=>(0,a.jsxs)("div",{className:"card p-4 md:p-6 space-y-4 transition-shadow hover:shadow-[0_10px_40px_rgba(0,0,0,0.35)]",onMouseEnter:()=>G(e.id),children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[a.jsx("div",{className:"flex items-center gap-3 min-w-0",children:(()=>{let t=e.user_id?f[e.user_id]:void 0,i=t?.avatar_url||"/avatar-fallback.png",s=t?.username||(e.user_id?e.user_id.slice(0,8):"Unknown");return(0,a.jsxs)(a.Fragment,{children:[a.jsx("img",{src:i,alt:"avatar",className:"h-9 w-9 rounded-full object-cover border border-white/10 shrink-0"}),a.jsx("div",{className:"flex flex-col min-w-0",children:a.jsx("div",{className:"text-sm text-white truncate",children:s})})]})})()}),(0,a.jsxs)("div",{className:"flex items-center gap-2 text-xs text-white/60",children:[a.jsx("span",{children:new Date(e.created_at).toLocaleString()}),u===e.user_id&&y!==e.id&&(0,a.jsxs)("div",{className:"flex gap-1.5 ml-2",children:[a.jsx(d.Z,{variant:"icon",ariaLabel:"Edit post",title:"Edit",onClick:()=>{S(e.id),D(e.body||"")},icon:a.jsx(K,{})}),a.jsx(d.Z,{variant:"icon",ariaLabel:"Delete post",title:"Delete",onClick:()=>H(e),icon:a.jsx(Q,{})})]})]})]}),y===e.id?(0,a.jsxs)("div",{className:"space-y-3",children:[a.jsx("textarea",{value:k,onChange:e=>D(e.target.value),className:"w-full bg-transparent border border-white/10 rounded-2xl p-3 outline-none"}),(0,a.jsxs)("div",{className:"flex gap-2",children:[a.jsx(d.Z,{onClick:()=>T(e),variant:"primary",children:"Save"}),a.jsx(d.Z,{onClick:()=>S(null),variant:"secondary",children:"Cancel"})]})]}):(0,a.jsxs)(a.Fragment,{children:[e.body&&a.jsx("p",{className:"leading-relaxed text-white",children:e.body}),e.image_url&&a.jsx("img",{src:e.image_url,className:"rounded-2xl border border-white/10",alt:""}),e.video_url&&a.jsx("video",{controls:!0,className:"w-full rounded-2xl border border-white/10",children:a.jsx("source",{src:e.video_url})})]}),(0,a.jsxs)("div",{className:"flex items-center gap-5 text-white/80",children:[(0,a.jsxs)("div",{className:"flex items-center gap-1",title:"Views",children:[a.jsx(J,{}),a.jsx("span",{className:"text-sm",children:e.views??0})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[a.jsx("button",{onClick:()=>U(e),className:`px-2 py-1 rounded-lg text-sm border transition ${F.has(e.id)?"border-white bg-white text-black":"border-white/20 hover:bg-white/10"}`,title:"Growth",children:"\uD83C\uDF31 Growth"}),a.jsx("button",{onClick:()=>U(e),className:`px-2 py-1 rounded-lg text-sm border transition ${F.has(e.id)?"border-white bg-white text-black":"border-white/20 hover:bg-white/10"}`,title:"Value",children:"\uD83D\uDC8E Value"}),a.jsx("button",{onClick:()=>U(e),className:`px-2 py-1 rounded-lg text-sm border transition ${F.has(e.id)?"border-white bg-white text-black":"border-white/20 hover:bg-white/10"}`,title:"With You",children:"\uD83E\uDD1D With You"})]}),a.jsx("span",{className:"text-sm text-white/60",children:e.likes_count??0}),(0,a.jsxs)("button",{className:"ml-auto text-sm underline hover:no-underline",onClick:async()=>{let t=!_[e.id];C(i=>({...i,[e.id]:t})),t&&!(M[e.id]?.length>0)&&await I(e.id)},children:["Comments (",W[e.id]??0,")"]})]}),_[e.id]&&(0,a.jsxs)("div",{className:"space-y-2",children:[M[e.id]?.map(e=>a.jsxs("div",{className:"rounded-xl bg-white/5 border border-white/10 p-2 text-sm",children:[a.jsxs("div",{className:"text-xs text-white/60 flex justify-between",children:[a.jsx("span",{children:e.user_id?.slice(0,8)||"Anon"}),a.jsx("span",{children:new Date(e.created_at).toLocaleString()})]}),a.jsx("div",{className:"mt-1",children:e.body})]},e.id)),(0,a.jsxs)("div",{className:"flex gap-2",children:[a.jsx("input",{value:P[e.id]||"",onChange:t=>q(i=>({...i,[e.id]:t.target.value})),placeholder:"Write a comment…",className:"input bg-transparent border border-white/10 py-2 focus:ring-0"}),a.jsx("button",{onClick:()=>X(e.id),className:"btn btn-primary",children:"Send"})]})]})]},e.id)),a.jsx(d.Z,{onClick:()=>v(!0),variant:"primary",className:"sm:hidden fixed right-6 bottom-6 shadow-lg",icon:a.jsx(ee,{}),children:"Post"})]}),b&&(0,a.jsxs)("div",{className:"fixed inset-0 z-50 flex items-center justify-center",children:[a.jsx("div",{className:"absolute inset-0 bg-black/90",onClick:()=>!g&&v(!1)}),a.jsx("div",{className:"relative z-10 w-full max-w-xl mx-auto p-4",children:(0,a.jsxs)("div",{className:"card p-4 md:p-6 shadow-[0_8px_40px_rgba(0,0,0,0.45)] space-y-4",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[a.jsx("div",{className:"text-white/80 font-medium",children:"Create post"}),a.jsx("button",{onClick:()=>!g&&v(!1),className:"text-white/60 hover:text-white","aria-label":"Close",children:"✕"})]}),a.jsx("textarea",{value:e,onChange:e=>t(e.target.value),placeholder:"What do you want to share?",className:"w-full bg-transparent outline-none placeholder-white/40 min-h-[120px] text-base md:text-lg text-white"}),a.jsx("input",{ref:c,type:"file",accept:"image/*,video/*",className:"hidden",onChange:e=>{let t=e.target.files?.[0]||null;if(!t){s(null),o(null);return}t.type.startsWith("image/")?(s(t),o(null)):t.type.startsWith("video/")?(o(t),s(null)):(s(null),o(null))}}),(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[a.jsx("button",{onClick:()=>c.current?.click(),className:"px-3 py-2 rounded-xl border border-white/20 text-white/80 hover:bg-white/10 text-sm",children:"\uD83D\uDCCE Media"}),(i||n)&&a.jsx("span",{className:"text-white/60 text-sm",children:i?`Image: ${i.name}`:n?`Video: ${n.name}`:""}),a.jsx("div",{className:"ml-auto",children:a.jsx(d.Z,{onClick:z,disabled:g,variant:"primary",children:g?"Publishing…":"Publish"})})]})]})})]})]})}d=(o.then?(await o)():o)[0],s()}catch(e){s(e)}})},2885:e=>{e.exports=require("@supabase/supabase-js")},2785:e=>{e.exports=require("next/dist/compiled/next-server/pages.runtime.prod.js")},6689:e=>{e.exports=require("react")},6405:e=>{e.exports=require("react-dom")},997:e=>{e.exports=require("react/jsx-runtime")},6197:e=>{e.exports=import("framer-motion")},7147:e=>{e.exports=require("fs")},1017:e=>{e.exports=require("path")},2781:e=>{e.exports=require("stream")},9796:e=>{e.exports=require("zlib")}};var t=require("../webpack-runtime.js");t.C(e);var i=e=>t(t.s=e),s=t.X(0,[567,640,899,774],()=>i(8017));module.exports=s})();