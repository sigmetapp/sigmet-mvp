(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[986],{7127:function(e,t,i){(window.__NEXT_P=window.__NEXT_P||[]).push(["/feed",function(){return i(3663)}])},6044:function(e,t,i){"use strict";var s=i(5893);i(7294);var a=i(1664),r=i.n(a),l=i(1093);function n(){for(var e=arguments.length,t=Array(e),i=0;i<e;i++)t[i]=arguments[i];return t.filter(Boolean).join(" ")}let d={sm:"text-sm px-3 py-1.5 gap-2",md:"text-sm px-4 py-2 gap-2",lg:"text-base px-5 py-3 gap-2"},o={sm:"h-9 w-9",md:"h-10 w-10",lg:"h-12 w-12"},c={primary:"text-[#0b1220] bg-[linear-gradient(90deg,#00ffc8,#7affc0)] shadow-[0_0_0_0_rgba(0,0,0,0)] hover:shadow-[0_0_24px_0_rgba(122,255,192,0.35)] focus-visible:ring-2 focus-visible:ring-[rgba(122,255,192,0.45)]",secondary:"text-[var(--accent)] border border-[color:var(--accent)]/60 bg-transparent hover:bg-[color:var(--accent)]/10 focus-visible:ring-2 focus-visible:ring-[rgba(122,255,192,0.35)]",ghost:"bg-transparent text-[var(--accent)] hover:text-white hover:[text-shadow:0_0_12px_rgba(122,255,192,0.6)] focus-visible:ring-2 focus-visible:ring-[rgba(122,255,192,0.25)]",icon:"text-[var(--text)]/80 bg-white/0 border border-white/15 hover:bg-white/10 hover:text-white focus-visible:ring-2 focus-visible:ring-[rgba(122,255,192,0.25)]",orange:"text-[#0b1220] bg-[linear-gradient(90deg,#ffd48a,#ff9b4a)] shadow-[0_0_0_0_rgba(0,0,0,0)] hover:shadow-[0_0_24px_0_rgba(255,155,74,0.35)] focus-visible:ring-2 focus-visible:ring-[rgba(255,155,74,0.45)]"};t.Z=function(e){let{variant:t="primary",size:i="md",icon:a,className:u,children:h,ariaLabel:m,href:x,...v}=e,p="icon"===t&&!h,f=n("inline-flex select-none items-center justify-center rounded-xl font-semibold focus-visible:outline-none transition will-change-transform",c[t],p?o[i]:d[i],p?"rounded-full":"rounded-xl",u),g=(0,s.jsxs)(l.E.span,{className:n("inline-flex items-center",p?"":"gap-2"),whileHover:{scale:1.03},whileTap:{scale:.98},children:[a,h&&(0,s.jsx)("span",{children:h})]});if(x){let{href:e,...t}=v;return(0,s.jsx)(r(),{href:x,"aria-label":m,className:f,...t,children:g})}let{type:w,...b}=v;return(0,s.jsx)("button",{type:w||"button","aria-label":m,className:f,...b,children:g})}},1695:function(e,t,i){"use strict";i.d(t,{Y:function(){return n}});var s=i(5893),a=i(7294),r=i(4967),l=i(1163);function n(e){let{children:t}=e,i=(0,l.useRouter)(),[n,d]=(0,a.useState)(!1);return((0,a.useEffect)(()=>{(async()=>{let{data:{user:e}}=await r.O.auth.getUser();e?d(!0):i.replace("/auth")})()},[i]),n)?(0,s.jsx)(s.Fragment,{children:t}):null}},3663:function(e,t,i){"use strict";i.r(t),i.d(t,{default:function(){return d}});var s=i(5893),a=i(7294),r=i(4967),l=i(1695),n=i(6044);function d(){return(0,s.jsx)(l.Y,{children:(0,s.jsx)(o,{})})}function o(){let[e,t]=(0,a.useState)(""),[i,l]=(0,a.useState)(null),[d,o]=(0,a.useState)(null),c=(0,a.useRef)(null),[u,h]=(0,a.useState)(null),[m,x]=(0,a.useState)([]),[v,p]=(0,a.useState)(!0),[f,g]=(0,a.useState)(!1),[w,b]=(0,a.useState)(!1),[j,_]=(0,a.useState)({}),[y,N]=(0,a.useState)(null),[k,C]=(0,a.useState)(""),[D,S]=(0,a.useState)({}),[E,O]=(0,a.useState)({}),[M,q]=(0,a.useState)({}),[W,F]=(0,a.useState)({}),[Z,P]=(0,a.useState)(new Set),A=(0,a.useRef)(new Set),B=(0,a.useMemo)(()=>[{id:"health",emoji:"\uD83D\uDC9A",title:"Health"},{id:"thinking",emoji:"\uD83E\uDDE0",title:"Thinking"},{id:"learning",emoji:"\uD83D\uDCDA",title:"Learning"},{id:"career",emoji:"\uD83E\uDDE9",title:"Career"},{id:"finance",emoji:"\uD83D\uDCB0",title:"Finance"},{id:"relationships",emoji:"\uD83E\uDD1D",title:"Relationships"},{id:"creativity",emoji:"\uD83C\uDFA8",title:"Creativity"},{id:"sport",emoji:"\uD83C\uDFC3‍♂️",title:"Sport"},{id:"habits",emoji:"⏱️",title:"Habits"},{id:"emotions",emoji:"\uD83C\uDF3F",title:"Emotions"},{id:"meaning",emoji:"✨",title:"Meaning"},{id:"community",emoji:"\uD83C\uDFD9️",title:"Community"}],[]),[L,U]=(0,a.useState)([]),[T,V]=(0,a.useState)(null);async function Y(){p(!0);let{data:e,error:t}=await r.O.from("posts").select("*").order("created_at",{ascending:!1}).limit(50);if(!t&&e){x(e),J(e);let t=Array.from(new Set(e.map(e=>e.user_id).filter(e=>!!e)));if(t.length>0){let{data:e}=await r.O.from("profiles").select("user_id, username, avatar_url").in("user_id",t);if(e){let t={};for(let a of e){var i,s;t[a.user_id]={username:null!==(i=a.username)&&void 0!==i?i:null,avatar_url:null!==(s=a.avatar_url)&&void 0!==s?s:null}}_(t)}}}p(!1)}async function R(e,t){let i=e.name.split(".").pop()||"bin",s="".concat(t,"/").concat(Date.now(),"-").concat(Math.random().toString(36).slice(2),".").concat(i),a=r.O.storage.from("posts"),{error:l}=await a.upload(s,e,{upsert:!1,contentType:e.type});if(l)throw l;let{data:n}=a.getPublicUrl(s);return n.publicUrl}async function H(){if(!u)return alert("Sign in required");if(!e&&!i&&!d)return alert("Post cannot be empty");g(!0);try{let s=null,a=null;i&&(s=await R(i,"images")),d&&(a=await R(d,"videos"));let{data:n,error:c}=await r.O.from("posts").insert({user_id:u,body:e||null,image_url:s,video_url:a}).select("*").single();if(c)throw c;n&&(x(e=>[n,...e]),F(e=>({...e,[n.id]:0}))),t(""),l(null),o(null),b(!1)}catch(e){alert(e.message||"Publish error")}finally{g(!1)}}async function z(e){if(!A.current.has(e)){A.current.add(e),x(t=>t.map(t=>{var i;return t.id===e?{...t,views:(null!==(i=t.views)&&void 0!==i?i:0)+1}:t}));try{let{error:t}=await r.O.rpc("increment_post_views",{p_id:e});if(t)throw t}catch(a){var t,i;let s=null!==(i=null===(t=m.find(t=>t.id===e))||void 0===t?void 0:t.views)&&void 0!==i?i:0;await r.O.from("posts").update({views:s+1}).eq("id",e)}}}async function G(e){if(!u)return alert("Sign in required");if(Z.has(e.id)){let{error:t}=await r.O.from("post_likes").delete().eq("post_id",e.id).eq("user_id",u);t||(P(t=>{let i=new Set(t);return i.delete(e.id),i}),x(t=>t.map(t=>{var i;return t.id===e.id?{...t,likes_count:Math.max(0,(null!==(i=t.likes_count)&&void 0!==i?i:1)-1)}:t})))}else{let{error:t}=await r.O.from("post_likes").insert({post_id:e.id,user_id:u});t||(P(t=>new Set(t).add(e.id)),x(t=>t.map(t=>{var i;return t.id===e.id?{...t,likes_count:(null!==(i=t.likes_count)&&void 0!==i?i:0)+1}:t})))}}async function X(e){if(!confirm("Delete this post?"))return;let{error:t}=await r.O.from("posts").delete().eq("id",e.id);if(t)return alert(t.message);x(t=>t.filter(t=>t.id!==e.id))}async function I(e){let{data:t,error:i}=await r.O.from("posts").update({body:k}).eq("id",e.id).select("*").single();!i&&t&&(x(i=>i.map(i=>i.id===e.id?t:i)),N(null))}async function J(e){F(Object.fromEntries(await Promise.all(e.map(async e=>{let{count:t}=await r.O.from("comments").select("*",{count:"exact",head:!0}).eq("post_id",e.id);return[e.id,t||0]}))))}async function K(e){let{data:t,error:i,count:s}=await r.O.from("comments").select("*",{count:"exact"}).eq("post_id",e).order("created_at",{ascending:!0});!i&&t&&(q(i=>({...i,[e]:t})),F(i=>({...i,[e]:null!=s?s:t.length})))}async function Q(e){if(!u)return alert("Sign in required");let t=(E[e]||"").trim();if(!t)return;let{data:i,error:s}=await r.O.from("comments").insert({post_id:e,user_id:u,body:t}).select("*").single();!s&&i&&(q(t=>({...t,[e]:[...t[e]||[],i]})),F(t=>{var i;return{...t,[e]:(null!==(i=t[e])&&void 0!==i?i:0)+1}}),O(t=>({...t,[e]:""})))}(0,a.useEffect)(()=>{r.O.auth.getUser().then(e=>{var t,i;let{data:s}=e;return h(null!==(i=null===(t=s.user)||void 0===t?void 0:t.id)&&void 0!==i?i:null)}),Y()},[]),(0,a.useEffect)(()=>{(async()=>{var e,t;let{data:i}=await r.O.auth.getUser(),s=null===(e=i.user)||void 0===e?void 0:e.id;if(!s)return;let{data:a}=await r.O.from("profiles").select("directions_selected").eq("user_id",s).maybeSingle(),l=(null==a?void 0:a.directions_selected)||[];U(l.slice(0,3)),V(null!==(t=l[0])&&void 0!==t?t:null)})()},[]),(0,a.useEffect)(()=>{u&&0!==m.length&&(async()=>{let e=m.map(e=>e.id),{data:t}=await r.O.from("post_likes").select("post_id").eq("user_id",u).in("post_id",e);P(new Set((t||[]).map(e=>e.post_id)))})()},[u,m]);let $=()=>(0,s.jsxs)("svg",{viewBox:"0 0 24 24",className:"h-5 w-5",children:[(0,s.jsx)("path",{d:"M2 12s3.5-7 10-7 10 7 10 7-3.5 7-10 7S2 12 2 12Z",stroke:"currentColor",strokeWidth:"1.5"}),(0,s.jsx)("circle",{cx:"12",cy:"12",r:"3",stroke:"currentColor",strokeWidth:"1.5"})]}),ee=()=>(0,s.jsxs)("svg",{viewBox:"0 0 24 24",className:"h-5 w-5",fill:"none",stroke:"currentColor",strokeWidth:"1.5",children:[(0,s.jsx)("path",{d:"M16.862 3.487a1.75 1.75 0 0 1 2.476 2.476l-10.3 10.3a4 4 0 0 1-1.694 1.01l-3.2.914.914-3.2a4 4 0 0 1 1.01-1.694l10.294-10.306Z"}),(0,s.jsx)("path",{d:"M15 5l4 4"})]}),et=()=>(0,s.jsxs)("svg",{viewBox:"0 0 24 24",className:"h-5 w-5",fill:"none",stroke:"currentColor",strokeWidth:"1.5",children:[(0,s.jsx)("path",{d:"M4 7h16"}),(0,s.jsx)("path",{d:"M10 11v6"}),(0,s.jsx)("path",{d:"M14 11v6"}),(0,s.jsx)("path",{d:"M6 7l1 12a2 2 0 0 0 2 2h6a2 2 0 0 0 2-2l1-12"}),(0,s.jsx)("path",{d:"M9 7V5a2 2 0 0 1 2-2h2a2 2 0 0 1 2 2v2"})]}),ei=()=>(0,s.jsxs)("svg",{viewBox:"0 0 24 24",className:"h-5 w-5",fill:"none",stroke:"currentColor",strokeWidth:"1.5",children:[(0,s.jsx)("path",{d:"M12 5v14"}),(0,s.jsx)("path",{d:"M5 12h14"})]});return(0,s.jsxs)("div",{className:"max-w-7xl mx-auto px-4 py-6 md:py-8",children:[(0,s.jsx)("div",{className:"mb-6 md:mb-8",children:(0,s.jsxs)("div",{className:"flex items-end justify-between",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h1",{className:"text-2xl md:text-3xl font-semibold tracking-tight gradient-text",children:"Your feed"}),(0,s.jsx)("p",{className:"text-white/70 mt-1",children:"Share progress and see what others are building."})]}),(0,s.jsx)("div",{className:"hidden sm:block",children:(0,s.jsx)(n.Z,{onClick:()=>b(!0),variant:"primary",className:"shadow-md",icon:(0,s.jsx)(ei,{}),children:"Create post"})})]})}),(0,s.jsxs)("div",{className:"max-w-3xl mx-auto space-y-6",children:[L.length>0&&(0,s.jsx)("div",{className:"card p-3 md:p-4",children:(0,s.jsx)("div",{className:"flex flex-wrap items-center gap-2",children:L.map(e=>{let t=B.find(t=>t.id===e),i=t?"".concat(t.emoji," ").concat(t.title):e,a=T===e;return(0,s.jsx)("button",{onClick:()=>V(e),className:"px-3 py-1.5 rounded-full text-sm transition border ".concat(a?"bg-white text-black border-white":"text-white/80 border-white/20 hover:bg-white/10"),children:i},e)})})}),v?(0,s.jsx)("div",{className:"text-white/60",children:"Loading…"}):m.map(e=>{var t,i,a,r;return(0,s.jsxs)("div",{className:"card p-4 md:p-6 space-y-4 transition-shadow hover:shadow-[0_10px_40px_rgba(0,0,0,0.35)]",onMouseEnter:()=>z(e.id),children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsx)("div",{className:"flex items-center gap-3 min-w-0",children:(()=>{let t=e.user_id?j[e.user_id]:void 0,i=(null==t?void 0:t.avatar_url)||"/avatar-fallback.png",a=(null==t?void 0:t.username)||(e.user_id?e.user_id.slice(0,8):"Unknown");return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("img",{src:i,alt:"avatar",className:"h-9 w-9 rounded-full object-cover border border-white/10 shrink-0"}),(0,s.jsx)("div",{className:"flex flex-col min-w-0",children:(0,s.jsx)("div",{className:"text-sm text-white truncate",children:a})})]})})()}),(0,s.jsxs)("div",{className:"flex items-center gap-2 text-xs text-white/60",children:[(0,s.jsx)("span",{children:new Date(e.created_at).toLocaleString()}),u===e.user_id&&y!==e.id&&(0,s.jsxs)("div",{className:"flex gap-1.5 ml-2",children:[(0,s.jsx)(n.Z,{variant:"icon",ariaLabel:"Edit post",title:"Edit",onClick:()=>{N(e.id),C(e.body||"")},icon:(0,s.jsx)(ee,{})}),(0,s.jsx)(n.Z,{variant:"icon",ariaLabel:"Delete post",title:"Delete",onClick:()=>X(e),icon:(0,s.jsx)(et,{})})]})]})]}),y===e.id?(0,s.jsxs)("div",{className:"space-y-3",children:[(0,s.jsx)("textarea",{value:k,onChange:e=>C(e.target.value),className:"w-full bg-transparent border border-white/10 rounded-2xl p-3 outline-none"}),(0,s.jsxs)("div",{className:"flex gap-2",children:[(0,s.jsx)(n.Z,{onClick:()=>I(e),variant:"primary",children:"Save"}),(0,s.jsx)(n.Z,{onClick:()=>N(null),variant:"secondary",children:"Cancel"})]})]}):(0,s.jsxs)(s.Fragment,{children:[e.body&&(0,s.jsx)("p",{className:"leading-relaxed text-white",children:e.body}),e.image_url&&(0,s.jsx)("img",{src:e.image_url,className:"rounded-2xl border border-white/10",alt:""}),e.video_url&&(0,s.jsx)("video",{controls:!0,className:"w-full rounded-2xl border border-white/10",children:(0,s.jsx)("source",{src:e.video_url})})]}),(0,s.jsxs)("div",{className:"flex items-center gap-5 text-white/80",children:[(0,s.jsxs)("div",{className:"flex items-center gap-1",title:"Views",children:[(0,s.jsx)($,{}),(0,s.jsx)("span",{className:"text-sm",children:null!==(i=e.views)&&void 0!==i?i:0})]}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("button",{onClick:()=>G(e),className:"px-2 py-1 rounded-lg text-sm border transition ".concat(Z.has(e.id)?"border-white bg-white text-black":"border-white/20 hover:bg-white/10"),title:"Growth",children:"\uD83C\uDF31 Growth"}),(0,s.jsx)("button",{onClick:()=>G(e),className:"px-2 py-1 rounded-lg text-sm border transition ".concat(Z.has(e.id)?"border-white bg-white text-black":"border-white/20 hover:bg-white/10"),title:"Value",children:"\uD83D\uDC8E Value"}),(0,s.jsx)("button",{onClick:()=>G(e),className:"px-2 py-1 rounded-lg text-sm border transition ".concat(Z.has(e.id)?"border-white bg-white text-black":"border-white/20 hover:bg-white/10"),title:"With You",children:"\uD83E\uDD1D With You"})]}),(0,s.jsx)("span",{className:"text-sm text-white/60",children:null!==(a=e.likes_count)&&void 0!==a?a:0}),(0,s.jsxs)("button",{className:"ml-auto text-sm underline hover:no-underline",onClick:async()=>{var t;let i=!D[e.id];S(t=>({...t,[e.id]:i})),i&&!((null===(t=M[e.id])||void 0===t?void 0:t.length)>0)&&await K(e.id)},children:["Comments (",null!==(r=W[e.id])&&void 0!==r?r:0,")"]})]}),D[e.id]&&(0,s.jsxs)("div",{className:"space-y-2",children:[null===(t=M[e.id])||void 0===t?void 0:t.map(e=>{var t;return(0,s.jsxs)("div",{className:"rounded-xl bg-white/5 border border-white/10 p-2 text-sm",children:[(0,s.jsxs)("div",{className:"text-xs text-white/60 flex justify-between",children:[(0,s.jsx)("span",{children:(null===(t=e.user_id)||void 0===t?void 0:t.slice(0,8))||"Anon"}),(0,s.jsx)("span",{children:new Date(e.created_at).toLocaleString()})]}),(0,s.jsx)("div",{className:"mt-1",children:e.body})]},e.id)}),(0,s.jsxs)("div",{className:"flex gap-2",children:[(0,s.jsx)("input",{value:E[e.id]||"",onChange:t=>O(i=>({...i,[e.id]:t.target.value})),placeholder:"Write a comment…",className:"input bg-transparent border border-white/10 py-2 focus:ring-0"}),(0,s.jsx)("button",{onClick:()=>Q(e.id),className:"btn btn-primary",children:"Send"})]})]})]},e.id)}),(0,s.jsx)(n.Z,{onClick:()=>b(!0),variant:"primary",className:"sm:hidden fixed right-6 bottom-6 shadow-lg",icon:(0,s.jsx)(ei,{}),children:"Post"})]}),w&&(0,s.jsxs)("div",{className:"fixed inset-0 z-50 flex items-center justify-center",children:[(0,s.jsx)("div",{className:"absolute inset-0 bg-black/90",onClick:()=>!f&&b(!1)}),(0,s.jsx)("div",{className:"relative z-10 w-full max-w-xl mx-auto p-4",children:(0,s.jsxs)("div",{className:"card p-4 md:p-6 shadow-[0_8px_40px_rgba(0,0,0,0.45)] space-y-4",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsx)("div",{className:"text-white/80 font-medium",children:"Create post"}),(0,s.jsx)("button",{onClick:()=>!f&&b(!1),className:"text-white/60 hover:text-white","aria-label":"Close",children:"✕"})]}),(0,s.jsx)("textarea",{value:e,onChange:e=>t(e.target.value),placeholder:"What do you want to share?",className:"w-full bg-transparent outline-none placeholder-white/40 min-h-[120px] text-base md:text-lg text-white"}),(0,s.jsx)("input",{ref:c,type:"file",accept:"image/*,video/*",className:"hidden",onChange:e=>{var t;let i=(null===(t=e.target.files)||void 0===t?void 0:t[0])||null;if(!i){l(null),o(null);return}i.type.startsWith("image/")?(l(i),o(null)):i.type.startsWith("video/")?(o(i),l(null)):(l(null),o(null))}}),(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[(0,s.jsx)("button",{onClick:()=>{var e;return null===(e=c.current)||void 0===e?void 0:e.click()},className:"px-3 py-2 rounded-xl border border-white/20 text-white/80 hover:bg-white/10 text-sm",children:"\uD83D\uDCCE Media"}),(i||d)&&(0,s.jsx)("span",{className:"text-white/60 text-sm",children:i?"Image: ".concat(i.name):d?"Video: ".concat(d.name):""}),(0,s.jsx)("div",{className:"ml-auto",children:(0,s.jsx)(n.Z,{onClick:H,disabled:f,variant:"primary",children:f?"Publishing…":"Publish"})})]})]})})]})]})}}},function(e){e.O(0,[93,888,774,179],function(){return e(e.s=7127)}),_N_E=e.O()}]);