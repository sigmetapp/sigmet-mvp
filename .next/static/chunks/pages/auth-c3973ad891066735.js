(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[473],{4661:function(e,t,s){(window.__NEXT_P=window.__NEXT_P||[]).push(["/auth",function(){return s(6459)}])},6459:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return o}});var a=s(5893),i=s(7294),n=s(4967),l=s(1664),r=s.n(l),c=s(3454);function o(){let[e,t]=(0,i.useState)("signin"),[s,l]=(0,i.useState)(""),[o,d]=(0,i.useState)(""),[u,m]=(0,i.useState)(!1),[h,x]=(0,i.useState)(),[p,w]=(0,i.useState)(!1),[b,f]=(0,i.useState)(""),[g,j]=(0,i.useState)(!1),[v,y]=(0,i.useState)(null);async function N(t){t.preventDefault(),m(!0),x(void 0);try{if("signup"===e){let e=c.env.NEXT_PUBLIC_REDIRECT_ORIGIN||window.location.origin,{error:t}=await n.O.auth.signUp({email:s,password:o,options:{emailRedirectTo:"".concat(e,"/auth/callback")}});if(t)throw t;x("Account created. Please confirm your email.")}else{var a,i;let{error:e}=await n.O.auth.signInWithPassword({email:s,password:o});if(e)throw e;let{data:t}=await n.O.auth.getUser(),l=!!(null===(i=t.user)||void 0===i?void 0:null===(a=i.user_metadata)||void 0===a?void 0:a.must_change_password);window.location.href=l?"/auth/reset":"/"}}catch(e){x(e.message||"Auth error")}finally{m(!1)}}async function S(){w(e=>!e),y(null)}async function _(e){if(e.preventDefault(),y(null),!b.trim()){y("Please enter your email or username.");return}j(!0);try{let e=await fetch("/api/reset-password",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({identifier:b.trim()})}),t=await e.json();if(!e.ok||(null==t?void 0:t.ok)===!1)throw Error((null==t?void 0:t.message)||"Failed to reset password");y("If the account exists, a temporary password has been emailed.")}catch(e){y((null==e?void 0:e.message)||"Failed to reset password")}finally{j(!1)}}return(0,a.jsxs)("div",{className:"min-h-screen grid md:grid-cols-2",children:[(0,a.jsxs)("div",{className:"hidden md:flex flex-col justify-between p-10 bg-sigmet",children:[(0,a.jsx)(r(),{href:"/",className:"text-white/90 text-xl font-semibold",children:"Sigmet"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-white text-4xl font-semibold mb-4",children:"Welcome back"}),(0,a.jsx)("p",{className:"text-white/70",children:"Sign in with email and password. Magic links are disabled."})]}),(0,a.jsxs)("div",{className:"text-white/40 text-xs",children:["\xa9 ",new Date().getFullYear()," Sigmet"]})]}),(0,a.jsx)("div",{className:"flex items-center justify-center p-6 md:p-12 bg-base.bg",children:(0,a.jsxs)("div",{className:"w-full max-w-md",children:[(0,a.jsxs)("div",{className:"flex gap-2 bg-white/5 p-1 rounded-xl mb-6",children:[(0,a.jsx)("button",{onClick:()=>t("signin"),className:"flex-1 py-2 rounded-lg text-sm ".concat("signin"===e?"bg-white text-black":"text-white/80"),children:"Sign in"}),(0,a.jsx)("button",{onClick:()=>t("signup"),className:"flex-1 py-2 rounded-lg text-sm ".concat("signup"===e?"bg-white text-black":"text-white/80"),children:"Create account"})]}),(0,a.jsxs)("form",{onSubmit:N,className:"card p-6 space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"label",children:"Email"}),(0,a.jsx)("input",{className:"input",type:"email",value:s,onChange:e=>l(e.target.value),required:!0,placeholder:"you@example.com"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"label",children:"Password"}),(0,a.jsx)("input",{className:"input",type:"password",value:o,onChange:e=>d(e.target.value),required:!0,placeholder:"Minimum 6 characters"})]}),h&&(0,a.jsx)("div",{className:"text-white/80 text-sm",children:h}),(0,a.jsx)("button",{type:"submit",disabled:u,className:"btn btn-primary w-full disabled:opacity-60",children:u?"Please wait":"signin"===e?"Sign in":"Create account"}),(0,a.jsx)("button",{type:"button",onClick:S,className:"w-full text-white/70 text-sm hover:text-white mt-2",children:"Forgot password"})]}),p&&(0,a.jsxs)("form",{onSubmit:_,className:"card p-6 mt-4 space-y-3",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"label",children:"Email or username"}),(0,a.jsx)("input",{className:"input",type:"text",value:b,onChange:e=>f(e.target.value),placeholder:"you@example.com or your_nickname"})]}),v&&(0,a.jsx)("div",{className:"text-white/80 text-sm",children:v}),(0,a.jsx)("button",{type:"submit",disabled:g,className:"btn btn-primary w-full disabled:opacity-60",children:g?"Sending...":"Reset Password"})]})]})})]})}}},function(e){e.O(0,[888,774,179],function(){return e(e.s=4661)}),_N_E=e.O()}]);